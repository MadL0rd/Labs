Turbo Assembler	 Version 3.1	    11/03/18 01:04:28	    Page 1
lab1boom.asm



      1	    0000			 .model	 small
      2	    0000			 .stack	 200h
      3					 .386
      4
      5	    0000			 .data
      6		  =00FF			 TRUE equ 255
      7		  =0000			 FALSE equ 0
      8
      9	    0000  30 24			 sphere	 db '0$'
     10	    0002  79			 sphere_attr db	79h
     11
     12	    0003  2A 20	42 4F 4F 4D 21+	 xplosion db '*	BOOM!$'
     13		  24
     14	    000B  74			 xplosion_attr db 74h
     15
     16	    000C  00			 minx db 0
     17	    000D  00			 miny db 0
     18	    000E  4F			 maxx db 79
     19	    000F  18			 maxy db 24
     20
     21	    0010  0001			 delayh	dw 1
     22	    0012  0000			 delayl	dw 0
     23	    0014  000A			 longdelay dw 10
     24
     25	    0016  23			 x1 db 35
     26	    0017  0C			 y1 db 12
     27	    0018  00			 dirx1 db 0
     28	    0019  00			 diry1 db 0
     29
     30	    001A  23			 x2 db 35
     31	    001B  0C			 y2 db 12
     32	    001C  FF			 dirx2 db 255
     33	    001D  00			 diry2 db 0
     34
     35	    001E			 .code
     36
     37					 ; уменьшает/увеличивает axis[0] в	зависимости от	    +
     38					 направления	в axis[1]
     39					 ; меняет	направление в соответствии с limits
     40					 ; записывает	новую позицию в al	и новое направление+
     41					 в ah
     42	    0000			 move_axis proc
     43		  =0004			 arg axis:word,	limits:byte = argslen
     44
     45	    0000  55			     push bp
     46	    0001  8B EC			     mov bp, sp
     47
     48	    0003  8B 46	04		     mov ax, axis
     49
     50					     ; проверяем направление движения
     51	    0006			     check_dir:
     52	    0006  80 FC	00			 cmp ah, FALSE
     53	    0009  75 11	90 90			 jne forward
     54
     55					     ; движемся	назад
     56	    000D			     backward:
     57	    000D  FE C8				 dec al
Turbo Assembler	 Version 3.1	    11/03/18 01:04:28	    Page 2
lab1boom.asm



     58
     59	    000F  3A 46	06			 cmp al, limits[0]
     60	    0012  75 17	90 90			 jne done
     61	    0016  80 F4	FF			 xor ah, TRUE
     62
     63	    0019  EB 10	90			 jmp done
     64
     65					     ; движемся	вперед
     66	    001C			     forward:
     67	    001C  FE C0				 inc al
     68
     69	    001E  3A 46	07			 cmp al, limits[1]
     70	    0021  75 08	90 90			 jne done
     71	    0025  80 F4	FF			 xor ah, TRUE
     72	    0028  EB 01	90			 jmp done
     73
     74	    002B			     done:
     75	    002B  8B E5				 mov sp, bp
     76	    002D  5D				 pop bp
     77	    002E  C2 0004			 ret argslen
     78
     79	    0031			 move_axis endp
     80
     81					 ;позиционируем курсор
     82	    0031			 set_cursor proc
     83	    0031  B7 00			     mov bh, 0	; в bh	 № видеостраницы
     84	    0033  B4 02			     mov ah, 2	; функция
     85	    0035  CD 10			     int 10h
     86	    0037  C3			     ret
     87	    0038			 set_cursor endp
     88
     89					 ; выводим шар
     90	    0038			 draw_sphere proc
     91	    0038  B4 09			     mov ah, 9	; функция
     92	    003A  CD 21			     int 21h	; выводим все	до доллара
     93	    003C  C3			     ret
     94	    003D			 draw_sphere endp
     95
     96					 ; очищает установленную позицию
     97	    003D			 cls proc
     98	    003D  B0 00			     mov al, 0
     99	    003F  B4 06			     mov ah, 6
    100	    0041  CD 10			     int 10h
    101	    0043  C3			     ret
    102	    0044			 cls endp
    103
    104					 ; начало	программы
    105	    0044			 start:
    106
    107					     ; адрес сегмента данных
    108	    0044  B8 0000s		     mov ax, @data
    109	    0047  8E D8			     mov ds, ax
    110
    111					     ; прячем курсор
    112	    0049  B4 01			     mov ah, 1
    113	    004B  B5 14			     mov ch, 20
    114	    004D  B1 00			     mov cl, 0
Turbo Assembler	 Version 3.1	    11/03/18 01:04:28	    Page 3
lab1boom.asm



    115	    004F  CD 10			     int 10h
    116
    117					     ; очищаем экран
    118	    0051  8A 3E	0002r		     mov bh, sphere_attr ; текущие атрибуты
    119	    0055  8A 0E	000Cr		     mov cl, minx	 ; координата	Х левого	верхнего угла   +
    120					 экрана (№ столбца)
    121	    0059  8A 2E	000Dr		     mov ch, miny	 ; координата	Y левого верхнего	угла    +
    122					 экрана (№ строки)
    123	    005D  8A 16	000Er		     mov dl, maxx	 ; координата	Х правого нижнего угла   +
    124					 экрана  (№ столбца)
    125	    0061  8A 36	000Fr		     mov dh, maxy	 ; координата	Y правого нижнего	угла    +
    126					 экрана  (№ строки)
    127	    0065  E8 FFD5		     call cls
    128
    129					 ; обновление	экрана
    130	    0068			 update:
    131
    132					     ; выодим круг 1
    133	    0068  8A 16	0016r		     mov dl, x1
    134	    006C  8A 36	0017r		     mov dh, y1
    135	    0070  E8 FFBE		     call set_cursor
    136	    0073  BA 0000r		     mov dx, offset sphere  ; в dx адрес первой буквы надписи
    137	    0076  E8 FFBF		     call draw_sphere
    138
    139					     ; выводим круг 2
    140	    0079  8A 16	001Ar		     mov dl, x2
    141	    007D  8A 36	001Br		     mov dh, y2
    142	    0081  E8 FFAD		     call set_cursor
    143	    0084  BA 0000r		     mov dx, offset sphere
    144	    0087  E8 FFAE		     call draw_sphere
    145
    146					     ; задержка
    147	    008A  B4 86			     mov ah, 86h
    148	    008C  8B 0E	0010r		     mov cx, delayh
    149	    0090  8B 16	0012r		     mov dx, delayl
    150	    0094  CD 15			     int 15h
    151
    152					     ; проверяем выход из программы и	паузу
    153	    0096  B2 FF			     mov dl, 0ffh
    154	    0098  B4 06			     mov ah, 6
    155	    009A  CD 21			     int 21h
    156					     ; никакая клавиша не нажата (zf=1)
    157	    009C  74 15	90 90		     jz	 clear
    158					     ; пробел
    159	    00A0  3C 20			     cmp al, 20h
    160	    00A2  74 0B	90 90		     je	hold
    161					     ; Esc
    162	    00A6  3C 1B			     cmp al, 1bh
    163	    00A8  0F 84	00D8		     je	 exit
    164	    00AC  EB 05	90		     jmp clear
    165
    166					 ; ждем любой клавиши
    167	    00AF			 hold:
    168	    00AF  B4 00			     mov ah, 0
    169	    00B1  CD 16			     int 16h
    170
    171					 ; стираем предыдущую позицию шаров
Turbo Assembler	 Version 3.1	    11/03/18 01:04:28	    Page 4
lab1boom.asm



    172	    00B3			 clear:
    173	    00B3  8A 3E	0002r		     mov bh, sphere_attr
    174
    175	    00B7  8A 0E	0016r		     mov cl, x1
    176	    00BB  8A 2E	0017r		     mov ch, y1
    177	    00BF  8A 16	0016r		     mov dl, x1
    178	    00C3  8A 36	0017r		     mov dh, y1
    179	    00C7  E8 FF73		     call cls
    180
    181	    00CA  8A 0E	001Ar		     mov cl, x2
    182	    00CE  8A 2E	001Br		     mov ch, y2
    183	    00D2  8A 16	001Ar		     mov dl, x2
    184	    00D6  8A 36	001Br		     mov dh, y2
    185	    00DA  E8 FF60		     call cls
    186
    187					 ; обновляем позиции кругов
    188	    00DD			 move:
    189					     ; ось x
    190	    00DD  8A 16	000Cr		     mov dl, minx
    191	    00E1  8A 36	000Er		     mov dh, maxx
    192
    193	    00E5  52			     push dx
    194	    00E6  A0 0016r		     mov al, x1
    195	    00E9  8A 26	0018r		     mov ah, dirx1
    196	    00ED  50			     push ax
    197	    00EE  E8 FF0F		     call move_axis
    198	    00F1  A2 0016r		     mov x1, al
    199	    00F4  88 26	0018r		     mov dirx1,	ah
    200
    201	    00F8  52			     push dx
    202	    00F9  A0 001Ar		     mov al, x2
    203	    00FC  8A 26	001Cr		     mov ah, dirx2
    204	    0100  50			     push ax
    205	    0101  E8 FEFC		     call move_axis
    206	    0104  A2 001Ar		     mov x2, al
    207	    0107  88 26	001Cr		     mov dirx2,	ah
    208
    209					     ; ось y
    210	    010B  8A 16	000Dr		     mov dl, miny
    211	    010F  8A 36	000Fr		     mov dh, maxy
    212
    213	    0113  52			     push dx
    214	    0114  A0 0017r		     mov al, y1
    215	    0117  8A 26	0019r		     mov ah, diry1
    216	    011B  50			     push ax
    217	    011C  E8 FEE1		     call move_axis
    218	    011F  A2 0017r		     mov y1, al
    219	    0122  88 26	0019r		     mov diry1,	ah
    220
    221	    0126  52			     push dx
    222	    0127  A0 001Br		     mov al, y2
    223	    012A  8A 26	001Dr		     mov ah, diry2
    224	    012E  50			     push ax
    225	    012F  E8 FECE		     call move_axis
    226	    0132  A2 001Br		     mov y2, al
    227	    0135  88 26	001Dr		     mov diry2,	ah
    228
Turbo Assembler	 Version 3.1	    11/03/18 01:04:28	    Page 5
lab1boom.asm



    229					 ; проверка столкновения кругов
    230	    0139			 check_collision:
    231	    0139  8A 26	0016r		     mov ah, x1
    232	    013D  3A 26	001Ar		     cmp ah, x2
    233	    0141  0F 85	FF23		     jne update
    234	    0145  8A 26	0017r		     mov ah, y1
    235	    0149  3A 26	001Br		     cmp ah, y2
    236	    014D  0F 85	FF17		     jne update
    237
    238					 ; эффект	при столкновении
    239	    0151			 collide:
    240	    0151  8A 3E	000Br		     mov bh, xplosion_attr
    241	    0155  8A 0E	0016r		     mov cl, x1
    242	    0159  8A 2E	0017r		     mov ch, y1
    243	    015D  8A 16	0016r		     mov dl, x1
    244	    0161  8A 36	0017r		     mov dh, y1
    245	    0165  E8 FED5		     call cls
    246
    247	    0168  8A 16	0016r		     mov dl, x1
    248	    016C  8A 36	0017r		     mov dh, y1
    249	    0170  E8 FEBE		     call set_cursor
    250	    0173  BA 0003r		     mov dx, offset xplosion
    251	    0176  E8 FEBF		     call draw_sphere
    252
    253					     ; задержка	при столкновении
    254	    0179  B4 86			     mov ah, 86h
    255	    017B  8B 0E	0014r		     mov cx, longdelay
    256	    017F  BA 0000		     mov dx, 0
    257	    0182  CD 15			     int 15h
    258
    259	    0184			 exit:
    260					     ; ресет курсора
    261	    0184  B4 01			     mov ah, 1
    262	    0186  B5 06			     mov ch, 6
    263	    0188  B1 07			     mov cl, 7
    264	    018A  CD 10			     int 10h
    265
    266					     ; выход
    267	    018C  B4 4C			     mov ah, 4ch
    268	    018E  B0 00			     mov al, 0
    269	    0190  CD 21			     int 21h
    270					 end start
Turbo Assembler	 Version 3.1	    11/03/18 01:04:28	    Page 6
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "11/03/18"
??FILENAME			  Text	 "lab1boom"
??TIME				  Text	 "01:04:27"
??VERSION			  Number 030A
@32BIT				  Text	 0
@CODE				  Text	 _TEXT
@CODESIZE			  Text	 0
@CPU				  Text	 0F0FH
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 LAB1BOOM
@INTERFACE			  Text	 00H
@MODEL				  Text	 2
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
ARGSLEN				  Number 0004
AXIS				  Number [DGROUP:BP+0004]
BACKWARD			  Near	 _TEXT:000D
CHECK_COLLISION			  Near	 _TEXT:0139
CHECK_DIR			  Near	 _TEXT:0006
CLEAR				  Near	 _TEXT:00B3
CLS				  Near	 _TEXT:003D
COLLIDE				  Near	 _TEXT:0151
DELAYH				  Word	 DGROUP:0010
DELAYL				  Word	 DGROUP:0012
DIRX1				  Byte	 DGROUP:0018
DIRX2				  Byte	 DGROUP:001C
DIRY1				  Byte	 DGROUP:0019
DIRY2				  Byte	 DGROUP:001D
DONE				  Near	 _TEXT:002B
DRAW_SPHERE			  Near	 _TEXT:0038
EXIT				  Near	 _TEXT:0184
FALSE				  Number 0000
FORWARD				  Near	 _TEXT:001C
HOLD				  Near	 _TEXT:00AF
LIMITS				  Number [DGROUP:BP+0006]
LONGDELAY			  Word	 DGROUP:0014
MAXX				  Byte	 DGROUP:000E
MAXY				  Byte	 DGROUP:000F
MINX				  Byte	 DGROUP:000C
MINY				  Byte	 DGROUP:000D
MOVE				  Near	 _TEXT:00DD
MOVE_AXIS			  Near	 _TEXT:0000
SET_CURSOR			  Near	 _TEXT:0031
SPHERE				  Byte	 DGROUP:0000
SPHERE_ATTR			  Byte	 DGROUP:0002
START				  Near	 _TEXT:0044
TRUE				  Number 00FF
UPDATE				  Near	 _TEXT:0068
X1				  Byte	 DGROUP:0016
X2				  Byte	 DGROUP:001A
XPLOSION			  Byte	 DGROUP:0003
XPLOSION_ATTR			  Byte	 DGROUP:000B
Turbo Assembler	 Version 3.1	    11/03/18 01:04:28	    Page 7
Symbol Table



Y1				  Byte	 DGROUP:0017
Y2				  Byte	 DGROUP:001B

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  STACK				  16  0200 Para	  Stack	  STACK
  _DATA				  16  001E Word	  Public  DATA
_TEXT				  16  0192 Word	  Public  CODE
